<!DOCTYPE html>
<html>
  <head>
    <title>2D Simulation AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      .arjs-loader {
        height: 100%;
        width: 100%;
        position: absolute;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: black;
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">
      <div>Loading, please wait...</div>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-marker type="pattern" url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/aframe/examples/marker-training/examples/pattern-files/pattern-kanji.patt">
        <a-entity
          id="simulation"
          position="0 0 0"
          scale="1 1 1"
          material="opacity: 0.8;"
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // The simulation code
      document.addEventListener('DOMContentLoaded', () => {
        const simulationEntity = document.querySelector('#simulation');

        // Initialize the 2D canvas inside the marker
        const canvas = document.createElement('canvas');
        canvas.width = 512;
        canvas.height = 512;
        simulationEntity.appendChild(canvas);

        const context = canvas.getContext('2d');

        const numAtoms = 100;
        const colors = ['#FF0000', '#00FF00', '#0000FF'];
        const atoms = [];

        for (let i = 0; i < numAtoms; i++) {
          atoms.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 2,
            color: colors[Math.floor(Math.random() * colors.length)],
          });
        }

        function draw() {
          context.clearRect(0, 0, canvas.width, canvas.height);
          context.fillStyle = 'black';
          context.fillRect(0, 0, canvas.width, canvas.height);

          atoms.forEach((atom) => {
            context.fillStyle = atom.color;
            context.beginPath();
            context.arc(atom.x, atom.y, 5, 0, 2 * Math.PI);
            context.fill();

            atom.x += atom.vx;
            atom.y += atom.vy;

            if (atom.x <= 0 || atom.x >= canvas.width) atom.vx *= -1;
            if (atom.y <= 0 || atom.y >= canvas.height) atom.vy *= -1;
          });

          requestAnimationFrame(draw);
        }

        draw();
      });
    </script>
  </body>
</html>
